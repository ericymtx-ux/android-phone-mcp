# Android Phone MCP Server

é€šè¿‡ USB è°ƒè¯•æ§åˆ¶ Android çœŸæœºçš„ MCP Serverï¼Œé›†æˆäº†ç«å±±å¼•æ“ (Volcengine) GUI Agent èƒ½åŠ›ã€‚

## ğŸŒŸ æ ¸å¿ƒç‰¹æ€§

- **è®¾å¤‡æ§åˆ¶**: ç»§æ‰¿è‡ª `phone-mcp` çš„å¼ºå¤§æ§åˆ¶èƒ½åŠ›ï¼Œæ”¯æŒç”µè¯ã€çŸ­ä¿¡ã€åª’ä½“ã€åº”ç”¨ç®¡ç†ç­‰ã€‚
- **æ™ºèƒ½æ„ŸçŸ¥**: æä¾›æˆªå›¾å‹ç¼©ã€XML ç®€åŒ– (Compact XML) åŠŸèƒ½ï¼Œä¼˜åŒ– VLM è¯†åˆ«æ•ˆç‡ã€‚
- **AI å¢å¼º**: å†…ç½®ç«å±±å¼•æ“ GUI Agent é›†æˆï¼Œæ”¯æŒè‡ªç„¶è¯­è¨€æŒ‡ä»¤æ§åˆ¶ï¼ˆå¦‚"æ‰“å¼€å¾®ä¿¡å‘æ¶ˆæ¯"ï¼‰ã€‚
- **åæ ‡è‡ªé€‚åº”**: æ”¯æŒ 0-1000 å½’ä¸€åŒ–åæ ‡ï¼Œé€‚é…ä¸åŒåˆ†è¾¨ç‡è®¾å¤‡ã€‚
- **è‡ªä¸»ä»»åŠ¡**: **[NEW]** æ”¯æŒè‡ªä¸»ä»»åŠ¡æ‰§è¡Œ (`run_autonomous_task`)ï¼Œåªéœ€ä¸€å¥æŒ‡ä»¤ï¼ŒAgent è‡ªåŠ¨è§‚å¯Ÿã€æ€è€ƒã€æ“ä½œç›´è‡³å®Œæˆã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
# 1. å®‰è£… Python ä¾èµ–
pip install -r requirements.txt

# 2. å®‰è£…ç³»ç»Ÿä¾èµ– (macOS)
brew install android-platform-tools scrcpy
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

éœ€è¦è®¾ç½® `ARK_API_KEY` ä»¥å¯ç”¨ç«å±±å¼•æ“è§†è§‰èƒ½åŠ›ã€‚

```bash
# å¤åˆ¶ç¤ºä¾‹é…ç½®
cp .env.example .env

# ç¼–è¾‘ .env å¡«å…¥ä½ çš„ Key
# ARK_API_KEY=sk-xxxx
```

### 3. å®‰è£…ä¸è¿è¡Œ

æ¨èä½¿ç”¨ `pip install -e .` å®‰è£…é¡¹ç›®ï¼Œè·å¾— `android-agent` å‘½ä»¤è¡Œå·¥å…·ã€‚

```bash
# 1. å®‰è£…é¡¹ç›® (Editableæ¨¡å¼)
pip install -e .

# 2. è¿è¡Œè‡ªä¸»ä»»åŠ¡ (CLI æ–¹å¼)
android-agent run "æ‰“å¼€é€šè¾¾ä¿¡ï¼Œæ‰¾åˆ°ä¸Šè¯æŒ‡æ•°"

# 3. è¿è¡Œ MCP Server
android-agent server
```

æˆ–è€…ä½¿ç”¨ `uvx` å¿«é€Ÿè¿è¡Œ Server:

```bash
uvx fastmcp run src/android_phone/server.py
```

## ğŸ› ï¸ å·¥å…·åˆ—è¡¨

### è‡ªä¸»æ™ºèƒ½ä½“ (Autonomous Agent)
| å·¥å…· | å‚æ•° | è¯´æ˜ |
|------|------|------|
| `run_autonomous_task` | goal, max_steps | **å…¨è‡ªåŠ¨æ‰§è¡Œ**ã€‚è¾“å…¥è‡ªç„¶è¯­è¨€ç›®æ ‡ï¼ˆå¦‚â€œæ‰“å¼€é€šè¾¾ä¿¡çœ‹ä¸Šè¯æŒ‡æ•°â€ï¼‰ï¼ŒAgent è‡ªåŠ¨é—­ç¯æ“ä½œã€‚ |

### åŸºç¡€æ§åˆ¶
| å·¥å…· | å‚æ•° | è¯´æ˜ |
|------|------|------|
| `connect` | serial (å¯é€‰) | è¿æ¥è®¾å¤‡ |
| `get_screen_state` | compact_xml, scale | è·å–æˆªå›¾å’Œ UI æ ‘ã€‚ |
| `tap` | x, y, normalized | ç‚¹å‡» (æ”¯æŒå½’ä¸€åŒ–åæ ‡) |
| `tap_element` | text / resource_id | æ™ºèƒ½ç‚¹å‡» (æ ¹æ®æ–‡æœ¬æˆ– ID) |
| `swipe` | x1, y1, x2, y2, normalized | æ»‘åŠ¨ |
| `input_text` | text | è¾“å…¥æ–‡æœ¬ |
| `press_key` | key | ç‰©ç†æŒ‰é”® (home, back, etc) |
| `list_apps` | - | åˆ—å‡ºç¬¬ä¸‰æ–¹åº”ç”¨ |
| `unlock_device` | - | å°è¯•è§£é”å±å¹• |

### AI Agent é›†æˆ (ä½çº§ API)
| å·¥å…· | å‚æ•° | è¯´æ˜ |
|------|------|------|
| `ask_volcengine_agent` | instruction | å•æ­¥è¯¢é—®ç«å±±å¼•æ“ GUI æ¨¡å‹ |
| `reset_volcengine_session` | - | é‡ç½®å¤šè½®å¯¹è¯å†å² |

## ğŸ¤– Skill é›†æˆ

æœ¬é¡¹ç›®å·²åŒ…å« Claude Code Skill å®šä¹‰ï¼Œå¯ä½œä¸º Skill è‡ªåŠ¨åŠ è½½ã€‚

- **ä½ç½®**: `skills/android-autonomous-agent/`
- **æ–‡æ¡£**: [Skill ä½¿ç”¨æŒ‡å—](docs/usage/skill_guide_zh.md)
- **èƒ½åŠ›**: æ”¯æŒè‡ªç„¶è¯­è¨€é©±åŠ¨çš„ Android æ‰‹æœºè‡ªä¸»æ“ä½œã€‚

## ğŸ“š å‚è€ƒé¡¹ç›®

æœ¬é¡¹ç›®çš„åŸºç¡€è®¾å¤‡æ§åˆ¶èƒ½åŠ›å‚è€ƒå¹¶ä½¿ç”¨äº† [phone-mcp](https://github.com/hao-cyber/phone-mcp) çš„åŠŸèƒ½ã€‚

## ğŸ§ª æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python3 -m pytest tests/ -v
```

### ç«å±±å¼•æ“ Action Parser

è§£æç«å±±å¼•æ“ GUI Agent è¿”å›çš„åŠ¨ä½œæŒ‡ä»¤ï¼Œæ”¯æŒä»¥ä¸‹æ ¼å¼ï¼š

```
Thought: <æ€è€ƒè¿‡ç¨‹>
Action: <åŠ¨ä½œ>(<å‚æ•°>)
```

**CLI è¾“å…¥è¾“å‡º**:
- `android-agent run` æ”¯æŒè‡ªç„¶è¯­è¨€æŒ‡ä»¤ã€‚
- æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šå®æ—¶æ‰“å° "Thought"ï¼ˆæ€è€ƒè¿‡ç¨‹ï¼‰å’Œ "Action"ï¼ˆæ‰§è¡ŒåŠ¨ä½œï¼‰ã€‚
- å¦‚æœä»»åŠ¡æ¶‰åŠæˆªå›¾ï¼Œæˆªå›¾æ–‡ä»¶ä¼šè‡ªåŠ¨ä¿å­˜åˆ° `.active_screenshots/` ç›®å½•ã€‚
- ä»»åŠ¡å®Œæˆåï¼ŒCLI ä¼šè¿”å›æœ€ç»ˆç»“æœæ–‡æœ¬ã€‚
